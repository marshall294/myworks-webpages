<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOD Lesson Plan Approval</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fb;
        }
        header {
            background-color: #3c8dbc;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        .form-container, .lesson-approval-container {
            width: 80%;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        .lesson-card {
            width: 30%;
            display: inline-block;
            margin: 10px;
            padding: 10px;
            background-color: #e7f7ff;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            border-radius: 8px;
            text-align: center;
        }
        .lesson-card h3 {
            font-size: 18px;
            margin: 10px 0;
        }
        .lesson-card button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .lesson-card button:hover {
            background-color: #45a049;
        }
        .lesson-card a {
            display: block;
            margin-top: 10px;
            color: #1e90ff;
            text-decoration: none;
        }
        select {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

    <header>
        <h1>HOD Lesson Plan Approval</h1>
    </header>

    <!-- Subject Filter for HOD -->
    <div class="lesson-approval-container">
        <h2>Filter by Subject</h2>
        <select id="subjectFilterHOD" onchange="filterBySubjectHOD()">
            <option value="All">All</option>
            <option value="Science">Science</option>
            <option value="Home Economics">Home Economics</option>
            <option value="Geography">Geography</option>
            <option value="Agricultural Science">Agricultural Science</option>
            <option value="Mathematics">Mathematics</option>
            <option value="Civic Education">Civic Education</option>
            <option value="English Studies">English Studies</option>
            <option value="History">History</option>
            <option value="Religious Studies (CRS/IRS)">Religious Studies (CRS/IRS)</option>
            <option value="Information and Communication Technology">Information and Communication Technology</option>
            <option value="Personal Social and Health Education (PSHE)">Personal Social and Health Education (PSHE)</option>
            <option value="General Knowledge">General Knowledge</option>
        </select>
    </div>

    <!-- Pending Lesson Plans for Approval -->
    <div class="lesson-approval-container">
        <h2>Pending Lesson Plans</h2>
        <div id="pendingLessonsHOD"></div>
    </div>

    <!-- Approved Lesson Plans -->
    <div class="lesson-approval-container">
        <h2>Approved Lesson Plans</h2>
        <div id="approvedLessonsHOD"></div>
    </div>

    <!-- Firebase v9+ CDN (use modules) -->
    <script type="module">
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyB-yDq_hasmJ-feBHqNv7d8TxiIRORw9nE",
            authDomain: "year5f-ff94c.firebaseapp.com",
            databaseURL: "https://year5f-ff94c-default-rtdb.firebaseio.com",
            projectId: "year5f-ff94c",
            storageBucket: "year5f-ff94c.firebasestorage.app",
            messagingSenderId: "725619624649",
            appId: "1:725619624649:web:8752cd00889bb07d41db18"
        };

        // Importing the necessary Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Load Pending Lessons for HOD (lessons awaiting approval)
        function loadPendingLessonsHOD() {
            const pendingLessonsContainer = document.getElementById("pendingLessonsHOD");
            const lessonPlansRef = ref(database, 'lessonPlans');
            
            get(lessonPlansRef).then((snapshot) => {
                pendingLessonsContainer.innerHTML = ""; // Clear any existing content
                snapshot.forEach((childSnapshot) => {
                    const lesson = childSnapshot.val();
                    const status = lesson.status;

                    // Only show lessons with 'pending' status
                    if (status === "pending") {
                        const lessonCard = document.createElement("div");
                        lessonCard.classList.add("lesson-card");
                        lessonCard.innerHTML = `
                            <h3>${lesson.subject} - ${lesson.topic}</h3>
                            <p>Week: ${lesson.week}</p>
                            <a href="${lesson.googleDocLink}" target="_blank">View Content</a>
                            <button onclick="approveLessonPlan('${childSnapshot.key}')">Approve</button>
                        `;
                        pendingLessonsContainer.appendChild(lessonCard);
                    }
                });
            }).catch((error) => {
                console.error("Error fetching pending lesson plans:", error);
            });
        }

        // Load Approved Lessons for HOD
        function loadApprovedLessonsHOD() {
            const approvedLessonsContainer = document.getElementById("approvedLessonsHOD");
            const lessonPlansRef = ref(database, 'lessonPlans');
            
            get(lessonPlansRef).then((snapshot) => {
                approvedLessonsContainer.innerHTML = ""; // Clear any existing content
                snapshot.forEach((childSnapshot) => {
                    const lesson = childSnapshot.val();
                    const status = lesson.status;

                    // Only show lessons with 'approved' status
                    if (status === "approved") {
                        const lessonCard = document.createElement("div");
                        lessonCard.classList.add("lesson-card");
                        lessonCard.innerHTML = `
                            <h3>${lesson.subject} - ${lesson.topic}</h3>
                            <p>Week: ${lesson.week}</p>
                            <a href="${lesson.googleDocLink}" target="_blank">View Google Doc</a>
                        `;
                        approvedLessonsContainer.appendChild(lessonCard);
                    }
                });
            }).catch((error) => {
                console.error("Error fetching approved lesson plans:", error);
            });
        }

        // Approve Lesson Plan
        function approveLessonPlan(lessonKey) {
            const lessonRef = ref(database, 'lessonPlans/' + lessonKey);
            set(lessonRef, { status: 'approved' }).then(() => {
                loadPendingLessonsHOD(); // Reload pending lessons after approval
                loadApprovedLessonsHOD(); // Reload approved lessons
                alert("Lesson Plan Approved");
            }).catch((error) => {
                console.error("Error approving lesson plan:", error);
            });
        }

        // Filter Lessons based on the selected subject (for HOD)
        function filterBySubjectHOD() {
            const subjectFilterHOD = document.getElementById("subjectFilterHOD").value;
            const pendingLessonsContainer = document.getElementById("pendingLessonsHOD");
            const approvedLessonsContainer = document.getElementById("approvedLessonsHOD");
            const lessonPlansRef = ref(database, 'lessonPlans');

            get(lessonPlansRef).then((snapshot) => {
                pendingLessonsContainer.innerHTML = "";
                approvedLessonsContainer.innerHTML = "";

                snapshot.forEach((childSnapshot) => {
                    const lesson = childSnapshot.val();
                    const status = lesson.status;

                    // Filter by subject (if subject is selected)
                    if (subjectFilterHOD === "All" || lesson.subject === subjectFilterHOD) {
                        const lessonCard = document.createElement("div");
                        lessonCard.classList.add("lesson-card");
                        lessonCard.innerHTML = `
                            <h3>${lesson.subject} - ${lesson.topic}</h3>
                            <p>Week: ${lesson.week}</p>
                            <a href="${lesson.googleDocLink}" target="_blank">View Google Doc</a>
                        `;
                        
                        if (status === "approved") {
                            approvedLessonsContainer.appendChild(lessonCard);
                        } else if (status === "pending") {
                            lessonCard.innerHTML += `<button onclick="approveLessonPlan('${childSnapshot.key}')">Approve</button>`;
                            pendingLessonsContainer.appendChild(lessonCard);
                        }
                    }
                });
            }).catch((error) => {
                console.error("Error fetching lesson plans:", error);
            });
        }

        // Initialize the page by loading lessons
        loadPendingLessonsHOD();
        loadApprovedLessonsHOD();

    </script>

</body>
</html>
